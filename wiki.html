<!doctype html>
<html lang="la">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wikipedia — Encyclopaedia (Obscura) — IE · Strategia · Bellum Hybridum</title>
<style>
  :root{
    /* Wikipedia-ish */
    --bg:#f8f9fa; --paper:#fff; --ink:#202122; --mut:#54595d;
    --line:#a2a9b1; --line2:#c8ccd1; --shade:#f8f9fa;
    --link:#0645ad; --visited:#0b0080;

    /* Hidden game layer (no hints) */
    --g:#10b981; --p:#a78bfa; --r:#ef4444; --grad:linear-gradient(90deg,var(--g),var(--p));
    --sans: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",Arial,sans-serif;
    --serif: Georgia, "Times New Roman", Times, serif;
    --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:var(--sans);line-height:1.55}
  a{color:var(--link);text-decoration:none}
  a:visited{color:var(--visited)}
  a:hover{text-decoration:underline}

  .wrap{max-width:1400px;margin:0 auto;padding:10px}
  .layout{display:grid;grid-template-columns:260px 1fr;gap:10px}
  @media(max-width:1100px){.layout{grid-template-columns:1fr}}
  .side,.main{background:var(--paper);border:1px solid var(--line);border-radius:6px}
  .side{padding:10px}
  .main{padding:0}

  .brand{display:flex;gap:10px;align-items:center;margin-bottom:10px;padding:6px 6px 10px;border-bottom:1px solid #eaecf0}
  .globe{width:44px;height:44px;border-radius:50%;
    background:radial-gradient(circle at 35% 30%, #fff, #dbe7ff 28%, #92b2ff 55%, #3a66d6 80%, #24489f 100%);
    border:1px solid var(--line);
  }
  .brand .t h1{margin:0;font-size:14px;font-weight:700}
  .brand .t div{font-size:12px;color:var(--mut)}

  .portlet{margin:10px 0}
  .portlet h2{margin:0 0 6px;font-size:12px;color:var(--mut);letter-spacing:.06em;text-transform:uppercase}
  .portlet a{display:block;padding:3px 0;font-size:14px}
  .portlet small{color:var(--mut)}

  .topbar{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px;border-bottom:1px solid #eaecf0}
  .search{flex:1;display:flex;gap:8px;align-items:center;max-width:760px}
  .search input{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:4px;background:#fff;font-family:var(--mono);font-size:13px}
  .btn{border:1px solid var(--line2);background:#fff;border-radius:4px;padding:8px 10px;cursor:pointer;font-size:13px}
  .btn:hover{border-color:var(--line)}

  .tabs{display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:10px 10px 0;border-bottom:1px solid #eaecf0}
  .tab{font-size:13px;padding:6px 10px;border:1px solid #eaecf0;border-bottom:0;border-radius:6px 6px 0 0;background:var(--shade);color:var(--mut);cursor:pointer;user-select:none}
  .tab.active{background:#fff;color:var(--ink);border-color:var(--line2);font-weight:700}
  .pane{padding:12px}
  .hidden{display:none!important}

  .articleTitle{font-family:var(--serif);font-size:34px;line-height:1.15;margin:8px 0 4px}
  .subtitle{color:var(--mut);font-size:13px;margin:0 0 10px}
  .hatnote{background:var(--shade);border:1px solid #eaecf0;border-radius:4px;padding:8px 10px;font-size:13px;color:var(--mut);margin:10px 0}
  .toc{background:var(--shade);border:1px solid #eaecf0;border-radius:4px;padding:10px;margin:12px 0;width:min(520px,100%)}
  .toc .t{font-weight:700;margin:0 0 6px;font-size:13px}
  .toc a{display:block;padding:2px 0;font-size:13px}
  .lvl2{padding-left:12px} .lvl3{padding-left:24px}

  .row{display:grid;grid-template-columns:1fr 320px;gap:12px;align-items:start}
  @media(max-width:1000px){.row{grid-template-columns:1fr}}
  .infobox{border:1px solid var(--line2);background:var(--shade);border-radius:4px;overflow:hidden}
  .infobox .hd{background:#eaecf0;padding:10px;font-weight:700;text-align:center}
  .infobox .bd{padding:10px;font-size:13px}
  .infobox dt{color:var(--mut);margin-top:8px}
  .infobox dd{margin:2px 0 0 0}

  .refs{font-size:13px}
  .refs ol{padding-left:18px}
  .refs li{margin:6px 0}
  .cats{margin-top:14px;border-top:1px solid #eaecf0;padding-top:10px;font-size:13px;color:var(--mut)}
  .cats a{margin-right:8px}

  /* External link safety: visible icon + domain tooltip (no deception) */
  .ext{display:inline-flex;align-items:center;gap:6px}
  .ext .ico{width:14px;height:14px;border-radius:3px;border:1px solid #c8ccd1;background:#fff;display:inline-flex;align-items:center;justify-content:center;font-size:10px;color:#6b7280}
  [data-domain]{position:relative}
  [data-domain]:hover::after{
    content:attr(data-domain);
    position:absolute;left:0;top:115%;
    background:#202122;color:#fff;font-size:12px;padding:6px 8px;border-radius:6px;white-space:nowrap;z-index:50
  }

  /* JP blocks obvious */
  .jp{border-left:6px solid #d33;padding-left:12px;margin:14px 0;background:#fff9f9;border:1px solid #ffe3e3;border-radius:4px}

  /* NO HINTS: only fog + unlock silently */
  body.fog .chaos{filter: blur(.72px) contrast(1.05);letter-spacing:.02em;user-select:none}
  body.fog .clean{opacity:.15;filter: blur(2px)}
  body.restore .chaos{filter:none;letter-spacing:normal;user-select:text}
  body.restore .clean{opacity:1;filter:none}

  /* Runes: clickable but unlabeled (still visible as glyph capsules) */
  .rune{
    display:inline-block;
    padding:0 6px;
    border:1px dashed rgba(16,185,129,.45);
    border-radius:10px;
    cursor:pointer;
    user-select:none;
    margin:0 2px;
    font-family:var(--mono);
    font-size:12px;
    background:#fff;
  }
  .rune:hover{border-color:rgba(167,139,250,.6)}
  .rune.taken{opacity:.35;filter:blur(1.2px);cursor:default}

  /* Hidden/locked */
  .locked{opacity:.18;filter:blur(2.2px);pointer-events:none;user-select:none}
  .unlocked{opacity:1;filter:none;pointer-events:auto}

  /* Japanese links area highlighted (as requested) */
  .jp a{font-weight:800}

  /* Long wall */
  .wall{font-family:var(--mono);font-size:13px;white-space:pre-wrap}

  .toast{
    position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
    background:#202122;color:#fff;border:1px solid #111;
    padding:10px 12px;border-radius:10px;opacity:0;pointer-events:none;
    transition:opacity .16s ease;max-width:min(980px,92vw);font-size:13px
  }
  .toast.show{opacity:1}
</style>
</head>

<body class="fog">
<div class="wrap">
  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="side">
      <div class="brand">
        <div class="globe" aria-hidden="true"></div>
        <div class="t">
          <h1>Wikipedia</h1>
          <div>Encyclopaedia libera (simulatio)</div>
        </div>
      </div>

      <div class="portlet">
        <h2>Navigatio</h2>
        <a href="#top">Pagina</a>
        <a href="#caput">Caput</a>
        <a href="#ie">Intelligentia</a>
        <a href="#strat">Strategia</a>
        <a href="#hyb">Hybridum</a>
        <a href="#jp">日本語</a>
        <a href="#refs">Fontes</a>
      </div>

      <div class="portlet">
        <h2>Index</h2>
        <small>
          <span class="rune" data-token="IE">ΙΕ</span>
          <span class="rune" data-token="STRAT">Σ</span>
          <span class="rune" data-token="HYBRID">Η</span>
          <span class="rune" data-token="JP">日</span>
          <span class="rune" data-token="ORDER">Ω</span>
        </small>
      </div>

      <div class="portlet">
        <h2>Linguae</h2>
        <small>
          Latine · tlhIngan Hol · Quenya · Sindarin · Telerin · (Avari-ish) · Valyrio Alto · Lorem · 日本語
        </small>
      </div>
    </aside>

    <!-- MAIN -->
    <section class="main" id="top">
      <div class="topbar">
        <div class="search">
          <input id="cmd" aria-label="cmd" placeholder="⌁" />
          <button class="btn" id="fogBtn">☍</button>
          <button class="btn" id="reset">⟲</button>
        </div>
      </div>

      <div class="tabs" role="tablist">
        <div class="tab active" data-tab="article">Pagina</div>
        <div class="tab" data-tab="talk">Colloquium</div>
        <div class="tab" data-tab="history">Historia</div>
        <div class="tab" data-tab="source">Fons</div>
      </div>

      <!-- ARTICLE -->
      <div class="pane" id="tab-article">
        <h1 class="articleTitle" id="caput">Intelligentia · Strategia · Bellum Hybridum</h1>
        <p class="subtitle">
          <span class="clean">↗ signum externum · dominium in supervolatu</span>
        </p>

        <div class="toc locked" id="toc">
          <div class="t">Index</div>
          <a href="#prooemium">1 Prooemium</a>
          <a class="lvl2" href="#ludus">1.1 Ludus (fragmenta)</a>
          <a href="#ie">2 Intelligentia (oeconomica)</a>
          <a class="lvl2" href="#ie-axes">2.1 Axis</a>
          <a href="#strat">3 Strategia</a>
          <a class="lvl2" href="#strat-nota">3.1 Notae</a>
          <a href="#hyb">4 Hybridum</a>
          <a class="lvl2" href="#hyb-lectio">4.1 Lectio</a>
          <a href="#jp">5 日本語</a>
          <a href="#mur">6 Mur</a>
          <a href="#refs">7 Fontes</a>
        </div>

        <div class="row">
          <div class="chaos">
            <section id="prooemium">
              <h2>Prooemium</h2>
              <p>
                <i>Ordo ab chao</i> · <i>Non multa sed multum</i> · <i>Festina lente</i> · <i>Caveat lector</i> ·
                tlhIngan Hol: <i>bIvalbe’ ‘e’ yImev</i> · <i>De’ lIghlu’</i> · <i>QInmey tIbuS</i> ·
                Quenya: <i>Elen síla lúmenn’ omentielvo</i> · <i>Nai elen siluva lyenna</i> ·
                Sindarin: <i>Mae govannen, mellon</i> · <i>Hith suilad</i> ·
                Telerin: <i>Elen síla i lómë</i> · <i>Lindë</i> ·
                Avari-ish: <i>naí… elen…</i> ·
                Valyrio Alto: <i>Skoros ñuhyz syt?</i> · <i>Ānogar isse</i> ·
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt.
                日本語：「霧」.
                <span class="rune" data-token="NYXO">!NYXO</span>
                <span class="rune" data-token="642">642</span>
              </p>
            </section>

            <section id="ludus">
              <h2>Ludus (fragmenta)</h2>
              <ul>
                <li>tlh: <i>Qapla’</i> <span class="rune" data-token="QAPLA">Q</span></li>
                <li>Quenya: <i>hiswë</i> · Sindarin: <i>hith</i> <span class="rune" data-token="HITH">h</span></li>
                <li>Valyrio: <i>ānogar</i> <span class="rune" data-token="ANOGAR">ā</span></li>
                <li>Quenya: <i>elen</i> <span class="rune" data-token="ELEN">✶</span></li>
                <li>Lorem: <i>finibus bonorum et malorum</i></li>
              </ul>
            </section>

            <section id="ie">
              <h2>Intelligentia (oeconomica)</h2>
              <p>
                <i>Vigilantia</i> · <i>custodia</i> · <i>signa</i> · <i>vestigia</i> ·
                tlh: <i>De’</i> · Quenya: <i>cen-</i> · Sindarin: <i>tir-</i> · Telerin: <i>cenë</i> ·
                Valyrio: <i>kepus</i> · Lorem: sed do eiusmod tempor.
              </p>
              <div class="hatnote" id="ie-axes">
                <i>axis</i>: (α) pauca fontes · (β) ritus brevis · (γ) tabellae breves.
              </div>
              <p>
                <span class="ext"><span class="ico">↗</span>
                  <a data-domain="wikipedia.org" target="_blank" rel="noopener"
                     href="https://fr.wikipedia.org/wiki/Intelligence_%C3%A9conomique">Intelligentia oeconomica</a>
                </span>
              </p>
              <p>
                <span class="rune" data-token="IE">ΙΕ</span>
                <span class="rune" data-token="IE">ΙΕ</span>
                <span class="rune" data-token="IE">ΙΕ</span>
              </p>
            </section>

            <section id="strat">
              <h2>Strategia</h2>
              <p>
                <i>finis</i> · <i>viae</i> · <i>instrumenta</i> · <i>tempus</i> ·
                tlh: <i>yIlo’</i> · Quenya: <i>lúmë</i> · Sindarin: <i>thangail</i> ·
                Telerin: <i>lindë</i> · Valyrio: <i>vestri</i> · Lorem: quis nostrud exercitation.
              </p>
              <div class="hatnote" id="strat-nota">
                <i>nota</i>: parva forma · iterare · stabilire.
              </div>
              <p>
                <span class="ext"><span class="ico">↗</span>
                  <a data-domain="wikipedia.org" target="_blank" rel="noopener"
                     href="https://en.wikipedia.org/wiki/Strategy">Strategia</a>
                </span>
              </p>
              <p>
                <span class="rune" data-token="STRAT">Σ</span>
                <span class="rune" data-token="STRAT">Σ</span>
              </p>
            </section>

            <section id="hyb">
              <h2>Hybridum</h2>
              <p>
                <i>instrumenta mixta</i> · <i>narrationes</i> · <i>signa</i> · <i>comparatio</i> ·
                tlh: <i>QInmey</i> · Quenya: <i>hiswë</i> · Sindarin: <i>hith</i> · Telerin: <i>lómë</i> ·
                Valyrio: <i>ānogar</i> · Lorem: perspiciatis unde omnis.
              </p>
              <div class="hatnote" id="hyb-lectio">
                <i>lectio</i>: dies · fontes · collatio · tarditas.
              </div>
              <p>
                <span class="ext"><span class="ico">↗</span>
                  <a data-domain="wikipedia.org" target="_blank" rel="noopener"
                     href="https://en.wikipedia.org/wiki/Hybrid_warfare">Bellum hybridum</a>
                </span>
                ·
                <span class="ext"><span class="ico">↗</span>
                  <a data-domain="nato.int" target="_blank" rel="noopener"
                     href="https://www.nato.int/cps/en/natohq/topics_156338.htm">Argumentum NATO</a>
                </span>
              </p>
              <p>
                <span class="rune" data-token="HYBRID">Η</span>
                <span class="rune" data-token="HYBRID">Η</span>
              </p>
            </section>

            <section id="jp" class="jp">
              <h2>日本語</h2>
              <p>赤い枠。リンク置き場。<b>dl.ouaisfi.eu/haha</b></p>
              <ul>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="dl.ouaisfi.eu" target="_blank" rel="noopener" href="https://dl.ouaisfi.eu/haha">dl.ouaisfi.eu/haha</a></span></li>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="dl.ouaisfi.eu" target="_blank" rel="noopener" href="https://dl.ouaisfi.eu/haha">dl.ouaisfi.eu/haha</a></span></li>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="dl.ouaisfi.eu" target="_blank" rel="noopener" href="https://dl.ouaisfi.eu/haha">dl.ouaisfi.eu/haha</a></span></li>
              </ul>
              <p>
                <span class="rune" data-token="JP">日</span>
                <span class="rune" data-token="JP">日</span>
              </p>
            </section>

            <section id="mur">
              <h2>Mur</h2>
              <div id="wall" class="wall"></div>
              <p>
                <span class="rune" data-token="ORDER">Ω</span>
                <span class="rune" data-token="ORDER">Ω</span>
              </p>
            </section>

            <section id="refs" class="refs">
              <h2>Fontes</h2>
              <ol>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="wikipedia.org" target="_blank" rel="noopener" href="https://fr.wikipedia.org/wiki/Intelligence_%C3%A9conomique">Intelligentia oeconomica</a></span></li>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="wikipedia.org" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Strategy">Strategia</a></span></li>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="wikipedia.org" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Hybrid_warfare">Bellum hybridum</a></span></li>
                <li><span class="ext"><span class="ico">↗</span><a data-domain="nato.int" target="_blank" rel="noopener" href="https://www.nato.int/cps/en/natohq/topics_156338.htm">Argumentum NATO</a></span></li>
              </ol>
              <div class="cats">
                Categoriae:
                <a href="#ie">Intelligentia</a>
                <a href="#strat">Strategia</a>
                <a href="#hyb">Hybridum</a>
                <a href="#jp">日本語</a>
                <a href="#mur">Mur</a>
              </div>
            </section>

            <div class="hatnote clean locked" id="cleanView">
              <i>pagina restituta</i>
            </div>
          </div>

          <aside>
            <div class="infobox">
              <div class="hd">Tabella</div>
              <div class="bd">
                <dl>
                  <dt>Genus</dt><dd>Simulatio “Wikipedia” + nebulam + runas</dd>
                  <dt>Linguae</dt><dd>LA · tlh · Q · S · T · AV · HV · Lorem · 日本語</dd>
                  <dt>Signa</dt><dd>↗ + dominium in supervolatu</dd>
                  <dt>JP</dt><dd><a href="#jp">dl.ouaisfi.eu/haha</a></dd>
                  <dt>Glyphi</dt><dd>ΙΕ / Σ / Η / 日 / Ω</dd>
                </dl>
              </div>
            </div>

            <div class="hatnote locked" id="lockBox">
              <span class="rune" data-token="IE">ΙΕ</span>
              <span class="rune" data-token="STRAT">Σ</span>
              <span class="rune" data-token="HYBRID">Η</span>
              <span class="rune" data-token="JP">日</span>
              <span class="rune" data-token="ORDER">Ω</span>
            </div>
          </aside>
        </div>
      </div>

      <!-- TALK -->
      <div class="pane hidden" id="tab-talk">
        <h1 class="articleTitle">Colloquium</h1>
        <div class="hatnote chaos">
          <i>Caveat lector</i> · tlh: <i>QInmey tIbuS</i> · Quenya: <i>cen-</i> · Sindarin: <i>tir-</i> · Lorem.
        </div>
        <p class="chaos">
          <i>Fragmenta · notae · murmura · lómë · hiswë · elen · ānogar · Qapla’</i>.
          <span class="rune" data-token="NYXO">!NYXO</span>
        </p>
      </div>

      <!-- HISTORY -->
      <div class="pane hidden" id="tab-history">
        <h1 class="articleTitle">Historia</h1>
        <div class="hatnote locked" id="histLock">⟂</div>
        <div class="hatnote unlocked hidden" id="histOpen">
          <ul class="chaos">
            <li>rev. XII — <i>nebula addita</i></li>
            <li>rev. XI — <i>runae dispersae</i></li>
            <li>rev. X — <i>mur textuum</i></li>
            <li>rev. IX — <i>日本語枠</i></li>
          </ul>
        </div>
      </div>

      <!-- SOURCE -->
      <div class="pane hidden" id="tab-source">
        <h1 class="articleTitle">Fons</h1>
        <pre class="chaos" style="white-space:pre-wrap;font-family:var(--mono);font-size:13px">
lorem(nebula) + runae(ΙΕ→Σ→Η→日→Ω) + pagina_unica
        </pre>
      </div>
    </section>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const toast = $("#toast");

  function ping(){ /* silent */ }
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 700);
  }

  // Tabs
  const tabs = $$(".tab");
  const panes = {
    article: $("#tab-article"),
    talk: $("#tab-talk"),
    history: $("#tab-history"),
    source: $("#tab-source")
  };
  tabs.forEach(t => t.addEventListener("click", () => {
    tabs.forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    Object.values(panes).forEach(p=>p.classList.add("hidden"));
    panes[t.dataset.tab].classList.remove("hidden");
  }));

  // Buttons are glyph-only (no hints)
  let fog = true;
  $("#fogBtn").addEventListener("click", () => {
    fog = !fog;
    document.body.classList.toggle("fog", fog);
    // no explanatory text
  });

  // Procedural wall (long)
  const wall = $("#wall");
  const VOLUME = 360; // long
  const BLOCK = 6;

  const pools = {
    LA:["Ordo ab chao.","Non multa sed multum.","Festina lente.","Caveat lector.","Primum vivere."],
    TLH:["bIvalbe’ ‘e’ yImev.","De’ lIghlu’.","QInmey tIbuS.","yInlIj yIchenmoH.","Qapla’."],
    Q:["Elen síla lúmenn’ omentielvo.","Nai elen siluva lyenna.","Hiswë mi lúmë.","Cen- quet-.","Lúmë ná turë."],
    S:["Mae govannen, mellon.","Hith suilad.","Tir i chent.","Thangail.","Caro an i-’lam."],
    T:["Elen síla i lómë.","Lindë.","Cenë i tecil.","Nórëa.","Lómë."],
    AV:["naí… elen…","hith-quen…","tir-quen…","cen-quen…","mellon…"],
    HV:["Skoros ñuhyz syt?","Ānogar isse.","Valar dohaeris.","Vestri iksos issa.","Kepus, ñuhyz."],
    L:["Lorem ipsum dolor sit amet.","Sed do eiusmod tempor incididunt.","Ut enim ad minim veniam.","Duis aute irure dolor.","Excepteur sint occaecat."],
    JP:["日本語：霧。","日本語：順番。","日本語：比較。","日本語：日付。","日本語：断片。"]
  };
  const pick = (arr)=>arr[Math.floor(Math.random()*arr.length)];

  let out = [];
  for(let i=1;i<=VOLUME;i++){
    const inject =
      (i%73===0) ? ` <span class="rune" data-token="IE">ΙΕ</span>` :
      (i%97===0) ? ` <span class="rune" data-token="STRAT">Σ</span>` :
      (i%131===0)? ` <span class="rune" data-token="HYBRID">Η</span>` :
      (i%167===0)? ` <span class="rune" data-token="JP">日</span>` :
      (i%199===0)? ` <span class="rune" data-token="ORDER">Ω</span>` : "";
    out.push(
      `—[${String(i).padStart(3,"0")}]— `+
      `LA:${pick(pools.LA)} `+
      `tlh:${pick(pools.TLH)} `+
      `Q:${pick(pools.Q)} `+
      `S:${pick(pools.S)} `+
      `T:${pick(pools.T)} `+
      `AV:${pick(pools.AV)} `+
      `HV:${pick(pools.HV)} `+
      `L:${pick(pools.L)} `+
      `${pick(pools.JP)}${inject}\n`
    );
    if(i%BLOCK===0) out.push("\n");
  }
  wall.innerHTML = out.join("");

  // Hidden quest chain (no hints on screen)
  const steps = ["IE","STRAT","HYBRID","JP","ORDER"];
  let stepIndex = 0;
  const collected = new Set();

  const toc = $("#toc");
  const cleanView = $("#cleanView");
  const lockBox = $("#lockBox");
  const histLock = $("#histLock");
  const histOpen = $("#histOpen");

  function applyUnlocks(){
    if(collected.has("IE")){
      toc.classList.remove("locked"); toc.classList.add("unlocked");
      lockBox.classList.remove("locked"); lockBox.classList.add("unlocked");
    }
    if(collected.has("HYBRID")){
      histLock.classList.add("hidden");
      histOpen.classList.remove("hidden");
      histOpen.classList.remove("hidden");
      histOpen.classList.add("unlocked");
    }
    if(collected.has("ORDER")){
      document.body.classList.add("restore");
      document.body.classList.remove("fog");
      fog = false;
      cleanView.classList.remove("locked"); cleanView.classList.add("unlocked");
    }
  }

  function award(token){
    token = token.toUpperCase();
    if(collected.has(token)) return;

    // strict order for main steps; no hint, no message
    if(steps.includes(token)){
      const expected = steps[stepIndex];
      if(token !== expected){
        // punishment: re-fog
        document.body.classList.add("fog");
        fog = true;
        return;
      }
      collected.add(token);
      stepIndex++;
      applyUnlocks();
      return;
    }

    // bonus: silent
    collected.add(token);
    applyUnlocks();
  }

  // Rune clicks
  document.addEventListener("click",(e)=>{
    const r = e.target.closest(".rune");
    if(!r) return;
    if(r.classList.contains("taken")) return;
    const token = r.getAttribute("data-token") || "";
    const before = collected.size;
    award(token);
    if(collected.size !== before){
      r.classList.add("taken");
    }
  });

  // Command input (glyph-only placeholder); accepts tokens, still no hints
  const cmd = $("#cmd");
  cmd.addEventListener("keydown",(e)=>{
    if(e.key!=="Enter") return;
    const v=(cmd.value||"").trim().toUpperCase();
    if(!v) return;
    const hit = steps.find(s=>v.includes(s)) || ["NYXO","642","ELEN","HITH","ANOGAR","QAPLA"].find(b=>v.includes(b));
    if(hit) award(hit);
    cmd.value = "⌁";
    cmd.select();
  });

  // Reset (silent)
  $("#reset").addEventListener("click",()=>{
    stepIndex = 0;
    collected.clear();
    toc.classList.add("locked"); toc.classList.remove("unlocked");
    cleanView.classList.add("locked"); cleanView.classList.remove("unlocked");
    lockBox.classList.add("locked"); lockBox.classList.remove("unlocked");
    histOpen.classList.add("hidden");
    histLock.classList.remove("hidden");
    document.body.classList.remove("restore");
    document.body.classList.add("fog");
    fog = true;
    $$(".rune.taken").forEach(x=>x.classList.remove("taken"));
  });

  // Konami unlock (still silent)
  const KONAMI = ["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];
  let kpos = 0;
  window.addEventListener("keydown",(e)=>{
    const key = e.key;
    const expect = KONAMI[kpos];
    if(key === expect || key.toLowerCase() === expect){
      kpos++;
      if(kpos===KONAMI.length){
        kpos=0;
        steps.forEach(s=>collected.add(s));
        stepIndex = steps.length;
        applyUnlocks();
      }
    } else kpos=0;
  });

  // Start: no extra text
  cmd.value = "⌁";
})();
</script>
</body>
</html>
